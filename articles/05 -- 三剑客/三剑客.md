# 三剑客

[^tag ]: linux unix



grep、sed、awk

### grep

```shell
grep [options] [pattern] file
```

options:

* -i 忽略字符大小写
* -n 显示匹配的行号
* -E 支持扩展 regex
* -c 仅统计匹配的行数
* -o 仅显示匹配的字符串本身
* -v 排除匹配到的行
* --color=alyways

### sed

```shell
sed [options] [command] file
```

options:

* -i 将输出写入到文件
* -r 支持 regex
* -n 取消默认 sed 输出
* -e 多次编辑

command:

* a: 追加（指定行**后**）
* d: 删除匹配行
* i: 在指定行**前**插入一行或多行文本
* p: 打印匹配的行
* s/\<regex\>/\<text\>/g: 匹配正则，将匹配到的内容替换为 text 的内容，`/g` 全局匹配 

### awk

```shell
awk [options] '[pattern] {<action>}'
```

options

* `-F`：指定输入的分隔符
* `-v`：指定某些默认参数的值 `-v <变量>='<值>'`
    * `FS`：输入分隔符，等价于 `-F`
    * `OFS` ：输出分隔符
    * `RS`：输入换行符
    * `ORS`：输出换行符

pattern:

* `NR==<num>` 指定格式化输入某一行（最常用）
* 比较、逻辑运算：`==`、`!=`、`&&`、`||`、`!`
* 正则表达式匹配
* `BEGIN` 和 `END` 特殊模式
    * `BEGIN{}`: 在 awk 开始读取任何输入行之前执行一次。用于初始化变量、打印表头等
    * `END{}`: 在 awk 处理完所有输入行之后执行一次。用于打印汇总、结果报告等

action:
* `print/printf`：打印（最常用）
* `getline`：获取下一行
* 变量操作：`var = "value"`、`count += 1` 或 `arr[key] = value`
* 流程控制：`if`、`for`、`while`、`next`
* 函数：`length()`、`gsub()`、`toupper()`、`sin()`

## sed实例

```shell
❯ sed '/^\s*[xy] = [0-9];$/ { s/x/i/; s/y/j/; }' file.nix
let
  inherit (
    {
      i = 1;
      j = 2;
    }
  ) i j;
in
  [ i j ]

❯ sed -E 's/\$\{([^}]+)\}/\$\{toString \1\}/g' file.nix
let
  x = 1;
in
  "${toString x} + ${toString x} = ${toString x + x}"

❯ sed -n '/^result:/{n;p}' test_text
165d1a5df1a5sf1casf1sa56ef
```